{% extends "base.html" %}

{% block title %}{{ current_path }} - File Browser{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('category_page', category=category) }}">{{ category }}</a></li>
    {% set path_parts = subpath.split('/') %}
    {% for part in path_parts %}
      <li class="breadcrumb-item {% if loop.last %}active{% endif %}">
        {% if not loop.last %}
          <a href="{{ url_for('browse_files', category=category, subpath='/'.join(path_parts[:loop.index])) }}">{{ part }}</a>
        {% else %}
          {{ part }}
        {% endif %}
      </li>
    {% endfor %}
  </ol>
</nav>

<h1>Contents of {{ current_path }}</h1>

{% if not contents %}
  <p>This folder is empty.</p>
{% else %}
  <ul class="file-list">
  {% for item in contents %}
    <li>
      <a href="{{ url_for('browse_files', category=category, subpath=(subpath + '/' + item).lstrip('/')) }}">
        {% if item.lower().endswith(('.pdf', '.doc', '.docx', '.txt', '.jpg', '.png', '.gif')) %}
          <i class="fas fa-file"></i>
        {% else %}
          <i class="fas fa-folder"></i>
        {% endif %}
        {{ item }}
      </a>
    </li>
  {% endfor %}
  </ul>
{% endif %}

{% if is_admin %}
  <h2>Upload File</h2>
  <form action="{{ url_for('upload_file_to_subfolder', category=category, subpath=subpath) }}" method="POST" enctype="multipart/form-data" class="upload-form">
    <div class="form-group">
      <label for="file">Select file to upload:</label>
      <input type="file" id="file" name="file" required class="form-control-file">
    </div>
    <button type="submit" class="btn btn-primary">Upload</button>
  </form>
{% endif %}

{% endblock %}